function init(){setMap()}function setMap(){d3.json(mapPath,function(e,t){return e?console.error(e):void d3.json(dataPath,function(e,a){return e?console.error(e):(processData(t,a),void drawMap(t))})})}function drawMap(e){var t=d3.select("#chartcontainer").append("svg").attr("width","100%").append("g");sizeChange(),t.selectAll(".state").data(e.features).enter().append("path").attr("d",path).attr("class","state");var a="Chlamydia trachomatis infection",r="2016",n=10,o="current_week";colorMap(a,r,n,o);for(var i=d3.range(1,10),s=i.length-1;s>=0;s--)sequenceMap("Chlamydia trachomatis infection","2016",i[s],"cum_2015");console.log(e),d3.select("#slider7").call(d3.slider().axis(!0).min(1).max(52).step(1).on("slide",function(e,t){sequenceMap("Chlamydia trachomatis infection","2016",t,"cum_2015")}))}function colorMap(e,t,a,r){var n=getDataRange(e,t,a,r);d3.selectAll(".state").style("fill",function(o){var i=getValueFromNest(o.properties,e,t,a,r);setCurrentData(o.properties,i,e,t,a,r);var s=getColor(i,n);return s})}function sequenceMap(e,t,a,r){var n=getDataRange(e,t,a,r);d3.selectAll(".state").transition().duration(10).style("fill",function(o){var i=getValueFromNest(o.properties,e,t,a,r);setCurrentData(o.properties,i,e,t,a,r);var s=getColor(i,n);return s})}function getColor(e,t){if(-1==e|void 0==e)return"#CCC7C8";var a=d3.scale.quantize().domain([t[0],t[1]]).range(YlOrBr);return a(e)}function getDataRange(e,t,a,r){var n=1/0,o=-(1/0);return d3.selectAll(".state").each(function(i,s){var c=Number(getValueFromNest(i.properties,e,t,a,r));n>=c&&-1!=c&&"undefined"!=c&&(n=c),c>=o&&-1!=c&&"undefined"!=c&&(o=c)}),[n,o]}function sizeChange(){d3.select("g").attr("transform","scale("+$("#chartcontainer").width()/900+")"),$("svg").height(.618*$("#chartcontainer").width())}function processData(e,t){var a=_.groupBy(t,"reporting_area");for(var r in e.features)for(var n in a)featureName=e.features[r].properties.NAME,featureName.toLowerCase()==n.toLowerCase()?assignDataToFeatureProperty(e.features[r].properties,a[n]):"District of Columbia"==featureName&&"DIST. OF COL."==n&&assignDataToFeatureProperty(e.features[r].properties,a[n])}function assignDataToFeatureProperty(e,t){var a=_.groupBy(t,"disease"),r={};_.each(a,function(e,t){r[t]=_.groupBy(e,"mmwr_year")});var n={};_.each(r,function(e,t){n[t]="",_.each(e,function(e,a){var r={};r[a]=_.groupBy(e,"mmwr_week"),n[t]=r})}),e.nested_data=n,e.rawdata=t}function setCurrentData(e,t,a,r,n,o){var i={};i.value=t,i.disease=a,i.year=r,i.week=n,e.currentData=i}function getCurrentValue(e){return e.currentData.value}function getValueFromNest(e,t,a,r,n){var o=-1;try{e.nested_data[t][a][r].length>1&&console.log("Warning: There is more than one row for this input combination ->disease: "+t+", year: "+a+", week: "+r),o=e.nested_data[t][a][r][0][n]}catch(i){console.log("DEBUG: The Value doesn't exist for this input combination -> disease: "+t+", year: "+a+", week: "+r+", method: "+n)}if(void 0==o){var o=-1;console.log("DEBUG: The Value doesn't exist for this input combination -> disease: "+t+", year: "+a+", week: "+r+", method: "+n)}return o}var mapPath="data/us4.json",dataPath="data/nmaj-nshg.json",colorScheme="YlOrBr",YlOrBr=["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"];d3.select(window).on("resize",sizeChange);var projection=d3.geo.albersUsa().scale(1100),path=d3.geo.path().projection(projection);window.onload=init();