!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof exports?(process.browser&&require("./d3.slider.css"),module.exports=e(require("d3"))):t.d3.slider=e(t.d3)}(this,function(t){return function e(){"use strict";function e(e){e.each(function(){function e(e){"boolean"==typeof u&&(u=t.svg.axis().ticks(Math.round(z/100)).tickFormat(b).orient("horizontal"===c?"bottom":"right")),p=m.ticks?m.copy().range([0,z]):m.copy().rangePoints([0,z],.5),u.scale(p);var n=e.append("svg").classed("d3-slider-axis d3-slider-axis-"+u.orient(),!0).on("click",F),r=n.append("g");"horizontal"===c?(n.style("margin-left",-f+"px"),n.attr({width:z+2*f,height:f}),"top"===u.orient()?(n.style("top",-f+"px"),r.attr("transform","translate("+f+","+f+")")):r.attr("transform","translate("+f+",0)")):(n.style("top",-f+"px"),n.attr({width:f,height:z+2*f}),"left"===u.orient()?(n.style("left",-f+"px"),r.attr("transform","translate("+f+","+f+")")):r.attr("transform","translate(0,"+f+")")),r.call(u)}function s(){if("array"!=i(h)){var e=Math.max(0,Math.min(z,t.event.offsetX||t.event.layerX));n(m.invert?r(m.invert(e/z)):a(e/z))}}function d(){if("array"!=i(h)){var e=z-Math.max(0,Math.min(z,t.event.offsetY||t.event.layerY));n(m.invert?r(m.invert(e/z)):a(e/z))}}function v(){"handle-one"===t.event.sourceEvent.target.id?g=1:"handle-two"==t.event.sourceEvent.target.id&&(g=2);var e=Math.max(0,Math.min(z,t.event.x));n(m.invert?r(m.invert(e/z)):a(e/z))}function E(){"handle-one"===t.event.sourceEvent.target.id?g=1:"handle-two"==t.event.sourceEvent.target.id&&(g=2);var e=z-Math.max(0,Math.min(z,t.event.y));n(m.invert?r(m.invert(e/z)):a(e/z))}function F(){t.event.stopPropagation()}m||(m=t.scale.linear().domain([o,l])),h=h||m.domain()[0];var q=t.select(this).classed("d3-slider d3-slider-"+c,!0),I=t.behavior.drag();if(I.on("dragend",function(){y.slideend(t.event,h)}),"array"==i(h)&&2==h.length?(k=q.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",F).call(I),M=q.append("a").classed("d3-slider-handle",!0).attr("id","handle-two").attr("xlink:href","#").on("click",F).call(I)):k=q.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",F).call(I),"horizontal"===c){if(q.on("click",s),"array"==i(h)&&2==h.length){w=t.select(this).append("div").classed("d3-slider-range",!0),k.style("left",x(m(h[0]))),w.style("left",x(m(h[0]))),I.on("drag",v);var P=100-parseFloat(x(m(h[1])));M.style("left",x(m(h[1]))),w.style("right",P+"%"),I.on("drag",v)}else k.style("left",x(m(h))),I.on("drag",v);z=parseInt(q.style("width"),10)}else{if(q.on("click",d),I.on("drag",E),"array"==i(h)&&2==h.length){w=t.select(this).append("div").classed("d3-slider-range-vertical",!0),k.style("bottom",x(m(h[0]))),w.style("bottom",x(m(h[0]))),I.on("drag",E);var T=100-parseFloat(x(m(h[1])));M.style("bottom",x(m(h[1]))),w.style("top",T+"%"),I.on("drag",E)}else k.style("bottom",x(m(h))),I.on("drag",E);z=parseInt(q.style("height"),10)}u&&e(q)})}function n(e){console.log(this);var n="array"==i(h)&&2==h.length?h[g-1]:h,a=x(m(r(n))),o=x(m(r(e))),l="horizontal"===c?"left":"bottom";if(a!==o){if("array"==i(h)&&2==h.length?(h[g-1]=e,t.event&&y.slide(t.event,h)):t.event&&y.slide(t.event.sourceEvent||t.event,h=e),h[0]>=h[1])return;if(1===g)"array"==i(h)&&2==h.length&&("left"===l?w.style("left",o):w.style("bottom",o)),d?k.transition().styleTween(l,function(){return t.interpolate(a,o)}).duration("number"==typeof d?d:250):k.style(l,o);else{var s=100-parseFloat(o),u=100-parseFloat(o);"left"===l?w.style("right",s+"%"):w.style("top",u+"%"),d?M.transition().styleTween(l,function(){return t.interpolate(a,o)}).duration("number"==typeof d?d:250):M.style(l,o)}}}function r(t){if(t===m.domain()[0]||t===m.domain()[1])return t;var e=t;if(v)e=a(m(t));else{var n=(t-m.domain()[0])%s;e=t-n,2*Math.abs(n)>=s&&(e+=n>0?s:-s)}return e}function a(t){var e=m.ticks?m.ticks():m.domain(),n=e.map(function(e){return t-m(e)}),r=-1,a=0,i=m.ticks?m.range()[1]:m.rangeExtent()[1];do r++,Math.abs(n[r])<i&&(i=Math.abs(n[r]),a=r);while(n[r]>0&&r<n.length-1);return e[a]}function i(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}var o=0,l=100,s=.01,d=!0,c="horizontal",u=!1,f=50,h,g=1,v=!1,m,p,y=t.dispatch("slide","slideend"),x=t.format(".2%"),b=t.format(".0"),k,M=null,w,z;return e.min=function(t){return arguments.length?(o=t,e):o},e.max=function(t){return arguments.length?(l=t,e):l},e.step=function(t){return arguments.length?(s=t,e):s},e.animate=function(t){return arguments.length?(d=t,e):d},e.orientation=function(t){return arguments.length?(c=t,e):c},e.axis=function(t){return arguments.length?(u=t,e):u},e.margin=function(t){return arguments.length?(f=t,e):f},e.value=function(t){return arguments.length?(h&&n(r(t)),h=t,e):h},e.snap=function(t){return arguments.length?(v=t,e):v},e.scale=function(t){return arguments.length?(m=t,e):m},t.rebind(e,y,"on"),e}});